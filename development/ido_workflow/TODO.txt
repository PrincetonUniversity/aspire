Merging into ASPIRE - summary:


Results analysis (sorry about the details, I'm afraid it's a sensitive matter, and it may teach us a little about the whole reconstruction process...):

Bottom lines:
The algorithm has several subtle points, which yield numeric inconsistencies between different running, and larger inconsistencies between slightly different implementations, but eventually all pairs of reconstructions had correlation >0.94 for all frequencies.
We may repeat some experiments directly through ASPIRE for the paper, but I really don't want to analyze it any further.

1. the merged code was compared to the local code under N=200, nn07&05, with/out S_weights and with/out J_weights; as well as N=1000 nn02 with S_weights and without J_weights (9 configurations total).

2. the following were consistently identical: projections, cls, Rij unsynced, Pij.

3. in most cases (6/9), jsync, Rij synced, and shifts were identical as well; and Ri was similar up to some coherent minuses and 1e-12 error (which is 1e-16 error per entry, probably due to eigenvectors computation).

4. in those 6/9 cases, aligning the two volumes and fsc-ing them yielded high consistency: >0.99 correlation until the highest frequency (including the highest...). however, when the volumes were aligned vs. the reference vol (rather than vs. each other), their correlation in high frequencies was reduced - teaching us that the alignment is quite sensitive to small differences(?). anyway, the fsc's against the reference were very similar, though it seems that bad luck (possible?) yielded big differences in the resolution (see attached N200 figure). when I aligned v2 against v1_ref-aligned, rather than against vref, it's resolution vs. vref improved and became much closer to that of v1 (about half an angstrom improvement)! so it really seems like kind of chaotic alignment.

5. in one case, there was a difference of one entry of Jsync, which is fair since the corresponding eigenvector entry was around 10^-7, so it's sign is sensitive to my power method. the Pij of this entry is 10^-90(!) so Ri doesn't seem to be affected.
however, coincidence or not, in the same reconstruction there was difference of ~55% in the shifts estimation! it is somehow caused by the 1e-11 difference in Ri (I neutralized all the other differences). is it possible that the shifts estimation is that unstable in certain cases?
In spite of that, the correlation between the volumes in this case was 0.98 until the highest frequency, which is surprising since you said those freqs were sensitive to shifts.

6. in two other cases there were few differences in Jsync - which again makes sense since the power method with the requirement ||v_new-v_old||<0.01 is clearly unstable.
the surprise was that it had non-negligible effect on Ri and shifts, and consequently on the volume as well. however, even in those "radical" cases, the correlation between the volumes was 0.94 until the highest frequency (including).


In addition, I need technical help with the following:

1. I used open_log('..../stdout.txt') in order to write the log_msg() into this file (rather than diary which I used before), but it doesn't work and stdout.txt remains empty.

2. cryo_align_densities spams all my screen even when verbose=0. it must be changed. you may use trinary verbose rather than binary if you need several levels of print details...



- create git infrastructural guide: store the common commands I need, check how to resolve, etc.


- multicls and averaged maps: did it go along together? where is the relevant code? what should I merge exactly? what results did I have? who to use the lab environment within aspire?
	- aspire_merge/output has nothing about nn00
	- multicls seems to have several cryo_clstack_... files in functions/, though I'm not sure any of them uses averaged maps.
	- if it was combined multicls and averaged maps, then multicls has several mains with flow corresponding to multicls, and they should be used.
	- no laboratory staff in multicls.
	- yes laboratory staff in aspire_merge - and they should be used both for the averaged maps opt AND for the params opt (radius, shifts etc.). look for old documentations as well - mail to yoel, maybe some excel.