function WriteMRC(map,pixA,filename,mode)% function WriteMRC(map,pixA,filename,mode)% Write out a 2D image or a 3D volume as an MRC map file, for example for viewing in% Chimera.  'map' is the 3D array, pixA is the voxel size in angstroms.% Mode sets the data type:% 0: uint8% 1: int16% 2: single (default)% 6: uint16% % fixed for 2D output as well.  fs 28 Aug 07% % % Test program: create an ellipsoid and store it as a map file.%   [x y z]=ndgrid(-32:31);%   m=(x.^2+(y*1.5).^2+z.^2)>20^2;%   WriteMRC(m,1,'maptest.mrc');if nargin<4    mode=2;end;    switch mode    case 0        string='uint8';    case 1        string='int16';    case 2        string='float32';    case 6        string='uint16';    otherwise        error(['Invalid data mode: ' num2str(mode)]);    end;sizes=size(map);if numel(sizes)<3    sizes(3)=1;end;    org=-floor(sizes/2);  % Default originf=WriteMRCHeader(map,pixA,filename,sizes(3),org,mode);count2=fwrite(f,map,string);fclose(f);return;